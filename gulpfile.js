var gulp = require('gulp'),
    gp_rename = require('gulp-rename'),    
    gp_concat = require('gulp-concat'),
    gp_uglify = require('gulp-uglify'),
    cleanCSS = require("gulp-clean-css");

gulp.task('minify-js', function(){
    jsfiles = "js/lib/jquery/jquery-1.9.1.js js/lib/jquery-ui/js/jquery-ui-1.9.1.custom.min.js js/lib/jquery-ui/addons/jquery-ui-timepicker.js js/hammer.min.js js/lib/underscore.js js/lib/backbone.js js/lib/leaflet/leaflet.js js/lib/json2.js js/lib/moment.min.js js/lib/raphael/raphael-min.js js/lib/mustache.js js/lib/ICanHaz.js js/lib/jspdf.min.js js/otp/otp.js js/otp/locale/English.js js/otp/locale/French.js js/otp/locale/German.js js/otp/config.js js/otp/debug.js js/otp/templates.js js/otp/util/DataStorage.js js/otp/util/Geo.js js/otp/util/Itin.js js/otp/util/Logger.js js/otp/util/Text.js js/otp/util/Time.js js/otp/util/Imperial.js js/otp/core/Webapp.js js/otp/core/Map.js js/otp/core/QueryLogger.js js/otp/core/PopupMenu.js js/otp/core/ContextMenu.js js/otp/core/MapContextMenu.js js/otp/core/WidgetManagerMenu.js js/otp/core/Geocoder.js js/otp/core/GeocoderBuiltin.js js/otp/core/SOLRGeocoder.js js/otp/core/TransitIndex.js js/otp/core/TrinetSessionManager.js js/otp/widgets/Widget.js js/otp/widgets/WidgetManager.js js/otp/widgets/Dialogs.js js/otp/modules/Module.js js/otp/modules/planner/PlannerModule.js js/otp/modules/planner/IconFactory.js js/otp/modules/planner/TripPlan.js js/otp/modules/planner/Itinerary.js js/otp/modules/planner/ItinerariesWidget.js js/otp/modules/bikeshare/BikeShareModule.js js/otp/modules/bikeshare/BikeStationsWidget.js js/otp/modules/multimodal/MultimodalPlannerModule.js js/otp/modules/calltaker/CallTakerModule.js js/otp/modules/calltaker/CallHistoryWidget.js js/otp/modules/calltaker/MailablesWidget.js js/otp/modules/calltaker/calltaker-models.js js/otp/modules/annotations/AnnotationsModule.js js/otp/modules/analyst/AnalystModule.js js/otp/modules/analyst/AnalystLegendWidget.js js/otp/modules/alerts/AlertsModule.js js/otp/modules/alerts/EntitiesWidget.js js/otp/modules/alerts/EditAlertWidget.js js/otp/modules/alerts/AlertsModule.js js/otp/modules/alerts/AlertsWidget.js js/otp/modules/alerts/EntitiesWidget.js js/otp/modules/alerts/EditAlertWidget.js js/otp/modules/alerts/alerts-models.js js/otp/modules/fieldtrip/FieldTripModule.js js/otp/modules/fieldtrip/FieldTripManagerWidget.js js/otp/modules/fieldtrip/FieldTripRequestWidget.js js/otp/modules/fieldtrip/FieldTripGeocoderWidget.js js/otp/modules/fieldtrip/SaveFieldTripWidget.js js/otp/modules/fieldtrip/SearchWidget.js js/otp/widgets/InfoWidget.js js/otp/widgets/tripoptions/RoutesSelectorWidget.js js/otp/widgets/tripoptions/TripOptionsWidget.js js/otp/widgets/tripoptions/LayersWidget.js js/otp/widgets/tripoptions/BikeTrianglePanel.js js/otp/widgets/transit/RouteBasedWidget.js js/otp/widgets/transit/StopViewerWidget.js js/otp/widgets/transit/StopFinderWidget.js js/otp/widgets/transit/TripViewerWidget.js js/otp/layers/StopsLayer.js js/otp/layers/HartStopsLayer.js js/otp/layers/BusPositionsLayer.js js/otp/layers/BikeStationsLayer.js js/otp/layers/BikeLanes.js js/lib/jquery/jquery-1.9.1.js js/lib/jquery-ui/js/jquery-ui-1.9.1.custom.min.js js/lib/jquery-ui/addons/jquery-ui-timepicker.js js/hammer.min.js js/lib/underscore.js js/lib/backbone.js js/lib/leaflet/leaflet.js js/lib/json2.js js/lib/moment.min.js js/lib/raphael/raphael-min.js js/lib/mustache.js js/lib/ICanHaz.js js/lib/jspdf.min.js js/otp/otp.js js/otp/locale/English.js js/otp/locale/French.js js/otp/locale/German.js js/otp/config.js js/otp/debug.js js/otp/templates.js js/otp/util/DataStorage.js js/otp/util/Geo.js js/otp/util/Itin.js js/otp/util/Logger.js js/otp/util/Text.js js/otp/util/Time.js js/otp/util/Imperial.js js/otp/core/Webapp.js js/otp/core/Map.js js/otp/core/QueryLogger.js js/otp/core/PopupMenu.js js/otp/core/ContextMenu.js js/otp/core/MapContextMenu.js js/otp/core/WidgetManagerMenu.js js/otp/core/Geocoder.js js/otp/core/GeocoderBuiltin.js js/otp/core/SOLRGeocoder.js js/otp/core/TransitIndex.js js/otp/core/TrinetSessionManager.js js/otp/widgets/Widget.js js/otp/widgets/WidgetManager.js js/otp/widgets/Dialogs.js js/otp/modules/Module.js js/otp/modules/planner/PlannerModule.js js/otp/modules/planner/IconFactory.js js/otp/modules/planner/TripPlan.js js/otp/modules/planner/Itinerary.js js/otp/modules/planner/ItinerariesWidget.js js/otp/modules/bikeshare/BikeShareModule.js js/otp/modules/bikeshare/BikeStationsWidget.js js/otp/modules/multimodal/MultimodalPlannerModule.js js/otp/modules/calltaker/CallTakerModule.js js/otp/modules/calltaker/CallHistoryWidget.js js/otp/modules/calltaker/MailablesWidget.js js/otp/modules/calltaker/calltaker-models.js js/otp/modules/annotations/AnnotationsModule.js js/otp/modules/analyst/AnalystModule.js js/otp/modules/analyst/AnalystLegendWidget.js js/otp/modules/alerts/AlertsModule.js js/otp/modules/alerts/EntitiesWidget.js js/otp/modules/alerts/EditAlertWidget.js js/otp/modules/alerts/AlertsModule.js js/otp/modules/alerts/AlertsWidget.js js/otp/modules/alerts/EntitiesWidget.js js/otp/modules/alerts/EditAlertWidget.js js/otp/modules/alerts/alerts-models.js js/otp/modules/fieldtrip/FieldTripModule.js js/otp/modules/fieldtrip/FieldTripManagerWidget.js js/otp/modules/fieldtrip/FieldTripRequestWidget.js js/otp/modules/fieldtrip/FieldTripGeocoderWidget.js js/otp/modules/fieldtrip/SaveFieldTripWidget.js js/otp/modules/fieldtrip/SearchWidget.js js/otp/widgets/InfoWidget.js js/otp/widgets/tripoptions/RoutesSelectorWidget.js js/otp/widgets/tripoptions/TripOptionsWidget.js js/otp/widgets/tripoptions/LayersWidget.js js/otp/widgets/tripoptions/BikeTrianglePanel.js js/otp/widgets/transit/RouteBasedWidget.js js/otp/widgets/transit/StopViewerWidget.js js/otp/widgets/transit/StopFinderWidget.js js/otp/widgets/transit/TripViewerWidget.js js/otp/layers/StopsLayer.js js/otp/layers/HartStopsLayer.js js/otp/layers/BusPositionsLayer.js js/otp/layers/BikeStationsLayer.js js/otp/layers/BikeLanes.js".split(" ");
    
    for (x in jsfiles)
        jsfiles[x] = "src/client/" + jsfiles[x];

    return gulp.src(jsfiles)
        .pipe(gp_concat('concat.js'))
        .pipe(gulp.dest('src/client'))
        .pipe(gp_rename('otp.min.js'))
        .pipe(gp_uglify())
        .pipe(gulp.dest("src/client"))
});

gulp.task('minify-css', function() {
    cssfiles = "js/lib/jquery-ui/css/smoothness/jquery-ui-1.9.1.custom.css js/lib/jquery-ui/addons/jquery-ui-timepicker.css js/lib/leaflet/leaflet.css js/otp/widgets/widget-style.css js/otp/modules/planner/planner-style.css js/otp/modules/bikeshare/bikeshare-style.css js/otp/modules/multimodal/multimodal-style.css js/otp/modules/calltaker/calltaker-style.css js/otp/modules/analyst/analyst-style.css js/otp/modules/alerts/alerts-style.css js/otp/modules/alerts/alerts-style.css js/otp/modules/fieldtrip/fieldtrip-style.css js/otp/widgets/tripoptions/tripoptions-style.css js/otp/widgets/transit/widgets-transit-style.css style.css".split(" ");

    for (x in cssfiles)
        cssfiles[x] = "src/client/" + cssfiles[x];

   return gulp.src(cssfiles)
        .pipe(gp_concat('concat.css'))
        .pipe(gulp.dest('src/client'))
        .pipe(gp_rename('otp.min.css'))
        .pipe(cleanCSS())
        .pipe(gulp.dest("src/client"));
});

gulp.task('default', ['minify-js', 'minify-css'], function(){});
